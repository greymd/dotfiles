# Reduce delay of key stroke
set -sg escape-time 1

set -g prefix C-f
unbind C-b

set -g default-terminal "screen-256color"

# Reload configure file with r key
bind r source-file ~/.tmux.conf \; display "Reloaded!"

# Send C-a to a program inside tmux by typing C-a*2
bind C-a send-prefix

# e and E keys for enable/disable synchronize panes.
bind e setw synchronize-panes on
bind E setw synchronize-panes off

# Make new windows/panes have the directory same as original one.
## For new windows
unbind c
bind c new-window -c "#{pane_current_path}"
## For new panes
## 1.9 changed the behaviour of split-window and new-window (I prefer the old style for split-window).
unbind %
bind-key % split-window -h -c "#{pane_current_path}"
unbind '"'
bind-key '"' split-window -v -c "#{pane_current_path}"

# Pane move with key bindings like vim
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind -Tcopy-mode-vi v send -X begin-selection
bind -Tcopy-mode-vi y send -X copy-selection-and-cancel
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# Resize panes with key bindings like vim
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Enable mouse operation
set-option -g mouse on

# Status bar settings
## Set left panel
set -g status-left-length 40
set -g status-left "#{?client_prefix,#[reverse],}#[fg=green]Session: #S #[fg=yellow]#I #[fg=cyan]#P #[default]"
## Right panel
set -g status-right "#[fg=cyan][%Y-%m-%d(%a) %H:%M]"
## Refresh interval (default value is 15)
set -g status-interval 60
## Centerize the location of window list.
set -g status-justify centre
## Enable visual notification.
setw -g monitor-activity on
set -g visual-activity on
## Locate status bar upper.
set -g status-position top
## border colors
set -g pane-border-fg magenta
set -g pane-active-border-fg green
set -g pane-active-border-bg default

# Default command is empty string
# set-option -g default-command ""

# Enable copy mode
## Apply vi key bind for copying
set-window-option -g mode-keys vi

## copy to clipboard
###
### Cygwin ONLY
###
if-shell "uname | grep -q CYGWIN" '\
  set-option -g default-command "which zsh 2>&1 > /dev/null && zsh"; \
  unbind -t vi-copy v; \
  bind-key -t vi-copy v begin-selection; \
  unbind -t vi-copy y; \
  bind-key -t vi-copy y copy-pipe "cat > /dev/clipboard"; \
  unbind -t vi-copy Enter; \
  bind-key -t vi-copy enter copy-pipe "cat > /dev/clipboard"; \
'

###
### Linux ONLY
###
if-shell "uname | grep -q Linux && which xsel && tmux -V | grep -Evq '(2.4|2.5|2.6)'" '\
  set-option -g default-command "which zsh 2>&1 > /dev/null && zsh"; \
  unbind -t vi-copy v; \
  bind-key -t vi-copy v begin-selection; \
  unbind -t vi-copy y; \
  bind-key -t vi-copy y copy-pipe "xsel -ib"; \
  unbind -t vi-copy Enter; \
  bind-key -t vi-copy Enter copy-pipe "xsel -ib"; \
'

###
### Linux ONLY (tmux 2.4 or upper)
###
if-shell "uname | grep -q Linux && which xsel && tmux -V | grep -Eq '(2.4|2.5|2.6)'" '\
  set-option -g default-command "which zsh 2>&1 > /dev/null && zsh"; \
  unbind -Tcopy-mode-vi v; \
  bind-key -Tcopy-mode-vi v send-keys -X begin-selection; \
  unbind -Tcopy-mode-vi y; \
  bind-key -Tcopy-mode-vi y send-keys -X copy-pipe-and-cancel "xsel -ib"; \
  unbind -Tcopy-mode-vi Enter; \
  bind-key -Tcopy-mode-vi Enter send-keys -X copy-pipe-and-cancel "xsel -ib"; \
'

###
### For Docker ( Allow OSC52 when xsed does not exist.)
###
if-shell "uname | grep -q Linux && ! which xsel" '\
  set -g prefix C-b; \
  unbind C-a; \
  set-option -g default-command "which zsh 2>&1 > /dev/null && zsh"; \
  set-option -ag terminal-overrides ",mlterm:Ms=\\E]52;%p1%s;%p2%s\\7"; \
  set-option -g set-clipboard on; \
'

###
### Bash on Windows
### win32yank.exe is required (https://github.com/equalsraf/win32yank).
###
if-shell "grep -q Microsoft /proc/version 2> /dev/null && which win32yank.exe" '\
  set-option -g default-command "which zsh 2>&1 > /dev/null && zsh"; \
  unbind -Tcopy-mode-vi v; \
  bind-key -Tcopy-mode-vi v send-keys -X begin-selection; \
  unbind -Tcopy-mode-vi y; \
  bind-key -Tcopy-mode-vi y send-keys -X copy-pipe-and-cancel "win32yank.exe -i"; \
  unbind -Tcopy-mode-vi Enter; \
  bind-key -Tcopy-mode-vi Enter send-keys -X copy-pipe-and-cancel "win32yank.exe -i"; \
  bind ] run "win32yank.exe -o | tr -d '\r' | tmux load-buffer - && tmux paste-buffer"; \
  bind-key -Troot MouseDown2Pane run "win32yank.exe -o | tr -d '\r' | tmux load-buffer - && tmux paste-buffer"; \
'

###
### macOS
###
if-shell "uname | grep -q Darwin && type pbcopy && tmux -V | grep -vqE '(2.4|2.5|2.6)'" '\
  set-option -g default-command "reattach-to-user-namespace -l zsh"; \
  unbind -t vi-copy v; \
  bind-key -t vi-copy v begin-selection; \
  unbind -t vi-copy y; \
  bind-key -t vi-copy y copy-pipe "reattach-to-user-namespace pbcopy"; \
  unbind -t vi-copy Enter; \
  bind-key -t vi-copy Enter copy-pipe "reattach-to-user-namespace pbcopy"; \
'

###
### macOS (tmux 2.4 or upper)
###
### disabled: set-option -g default-command "reattach-to-user-namespace -l zsh";
### Because Command + v does not work with tmux 2.5
if-shell "uname | grep -q Darwin && type pbcopy && tmux -V | grep -qE '(2.4|2.5|2.6)'" '\
  unbind -Tcopy-mode-vi v; \
  bind-key -Tcopy-mode-vi v send-keys -X begin-selection; \
  unbind -Tcopy-mode-vi y; \
  bind-key -Tcopy-mode-vi y send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"; \
  unbind -Tcopy-mode-vi Enter; \
  bind-key -Tcopy-mode-vi Enter send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"; \
'

#### COLOUR (Solarized dark)

# default statusbar colors
set-option -g status-fg yellow #yellow
set-option -g status-bg black #base02
set-option -g status-attr default

# default window title colors
set-window-option -g window-status-fg brightblue #base0
set-window-option -g window-status-bg default
#set-window-option -g window-status-attr dim

# active window title colors
set-window-option -g window-status-current-fg brightred #orange
set-window-option -g window-status-current-bg default
#set-window-option -g window-status-current-attr bright

# pane border
set-option -g pane-border-fg black #base02
set-option -g pane-active-border-fg brightgreen #base01

# message text
set-option -g message-bg black #base02
set-option -g message-fg brightred #orange

# pane number display
set-option -g display-panes-active-colour blue #blue
set-option -g display-panes-colour brightred #orange

# clock
set-window-option -g clock-mode-colour green #green

# set -g @adtty 'A'
set -g @plugin 'greymd/tmux-adtty'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
